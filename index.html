<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù…Ø¯ÛŒØ±ÛŒØª Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø±ÙˆØ²Ø§Ù†Ù‡</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root { --primary-color: #2c3e50; --accent-color: #27ae60; --blue-btn: #2980b9; --red-btn: #c0392b; --gray-bg: #f9f9f9; }
        body { font-family: Tahoma, Geneva, sans-serif; background-color: #f0f2f5; padding: 20px; font-size: 13px; color: #333; }
        .container { max-width: 1250px; margin: auto; background: white; padding: 25px; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        
        #capture-area { background: white; padding: 15px; border-radius: 4px; }
        .top-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; border-bottom: 2px solid #333; padding-bottom: 15px; }
        
        .header-item { display: flex; align-items: center; font-weight: bold; white-space: nowrap; gap: 4px; }
        .header-item input, .header-item select { border: none; border-bottom: 1px solid #ccc; padding: 4px; outline: none; background: transparent; font-family: Tahoma; font-size: 13px; font-weight: bold; color: #2c3e50; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 10px; table-layout: fixed; border: 1px solid #bdc3c7; }
        th { background-color: #34495e; color: white; padding: 12px; border: 1px solid #2c3e50; font-weight: bold; font-size: 12px; }
        td { border: 1px solid #bdc3c7; padding: 8px; text-align: center; height: 40px; word-wrap: break-word; vertical-align: middle; }
        
        /* Ø§Ø³ØªØ§ÛŒÙ„ Ù…ØªÙ…Ø§ÛŒØ² Ø¨Ø±Ø§ÛŒ Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ÛŒ Ú©Ø§Ø±ÛŒ */
        .row-work { font-weight: bold; color: #000; }
        .row-personal { font-weight: normal; color: #7f8c8d; }
        tr:nth-child(even) { background-color: var(--gray-bg); }
        
        .status-cell { cursor: pointer; font-size: 20px; user-select: none; width: 45px; }
        .status-check { color: #27ae60; text-shadow: 1px 1px 1px #eee; }
        .status-cross { color: #e74c3c; text-shadow: 1px 1px 1px #eee; }

        .actions { margin: 20px 0; display: flex; align-items: center; gap: 10px; }
        .spacer { flex-grow: 1; }
        
        /* Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ ØªÙÚ©ÛŒÚ© Ø±Ù†Ú¯ÛŒ Ø¨Ù‡ØªØ± */
        .btn { padding: 10px 18px; border: none; border-radius: 5px; cursor: pointer; color: white; font-family: Tahoma; font-weight: bold; font-size: 12px; transition: opacity 0.2s; }
        .btn:hover { opacity: 0.85; }
        .btn-new { background-color: var(--accent-color); box-shadow: 0 2px 4px rgba(39, 174, 96, 0.3); }
        .btn-clear { background-color: #95a5a6; }
        .btn-edit { background-color: var(--blue-btn); padding: 5px 10px; font-size: 11px; }
        .btn-delete { background-color: var(--red-btn); padding: 5px 10px; font-size: 11px; }
        .btn-img { background-color: #8e44ad; }
        .btn-share-direct { background-color: #d35400; }

        .summary-report { margin-top: 40px; padding: 25px; border: 2px solid #34495e; background-color: #fff; width: fit-content; min-width: 300px; border-radius: 10px; }
        .summary-report h3 { margin-top: 0; border-bottom: 2px solid #eee; padding-bottom: 12px; text-align: center; color: #2c3e50; }
        .report-field { display: flex; align-items: center; margin-bottom: 12px; }
        .report-field label { font-weight: bold; width: 110px; display: flex; justify-content: space-between; color: #34495e; }
        .report-field input { width: 75px; padding: 6px; border: 1px solid #bdc3c7; border-radius: 4px; text-align: center; margin-right: 15px; font-weight: bold; }

        .backup-section { margin-top: 40px; display: flex; gap: 15px; border-top: 1px solid #ddd; padding-top: 25px; }
        .btn-backup { background-color: #34495e; font-size: 11px; opacity: 0.8; }

        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); backdrop-filter: blur(3px); }
        .modal-content { background-color: white; margin: 5% auto; padding: 30px; border-radius: 12px; width: 420px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .form-group { margin-bottom: 15px; display: flex; flex-direction: column; }
        .form-group label { margin-bottom: 8px; font-weight: bold; color: #2c3e50; }
        .form-group input, .form-group select { padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-family: Tahoma; }
    </style>
</head>
<body>

<div class="container">
    <div id="capture-area">
        <div class="top-header">
            <div class="header-item">Ø¨Ø±Ù†Ø§Ù…Ù‡ ØªÛŒÙ…ÛŒ:<input type="text" id="ownerName" oninput="saveCurrentData()"></div>
            <div class="header-item">Ø±ÙˆØ²:<select id="selDayName" onchange="saveCurrentData()">
                <option value="Ø´Ù†Ø¨Ù‡">Ø´Ù†Ø¨Ù‡</option><option value="ÛŒÚ©Ø´Ù†Ø¨Ù‡">ÛŒÚ©Ø´Ù†Ø¨Ù‡</option>
                <option value="Ø¯ÙˆØ´Ù†Ø¨Ù‡">Ø¯ÙˆØ´Ù†Ø¨Ù‡</option><option value="Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡">Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡</option>
                <option value="Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡">Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡</option><option value="Ù¾Ù†Ø¬Ø´Ù†Ø¨Ù‡">Ù¾Ù†Ø¬Ø´Ù†Ø¨Ù‡</option>
                <option value="Ø¬Ù…Ø¹Ù‡">Ø¬Ù…Ø¹Ù‡</option>
            </select></div>
            <div class="header-item">Ù…ÙˆØ±Ø®Ù‡:<select id="selDay" onchange="handleDateChange()"></select>/<select id="selMonth" onchange="handleDateChange()"></select>/<select id="selYear" onchange="handleDateChange()"></select></div>
            <div class="header-item">ØªÙˆØ¶ÛŒØ­Ø§Øª:<input type="text" id="extraNote" style="width: 200px;" oninput="saveCurrentData()"></div>
        </div>

        <table>
            <thead>
                <tr>
                    <th style="width: 40px;">Ø±Ø¯ÛŒÙ</th><th style="width: 55px;">Ù†ØªÛŒØ¬Ù‡</th>
                    <th>Ø¹Ù†ÙˆØ§Ù† Ø¬Ù„Ø³Ù‡</th><th>Ù…Ø®Ø§Ø·Ø¨</th><th>Ù…Ø¹Ø±Ù</th>
                    <th style="width: 75px;">Ø³Ø§Ø¹Øª</th><th>Ù…Ú©Ø§Ù†</th>
                    <th>Ø¨Ø±Ú¯Ø²Ø§Ø±Ú©Ù†Ù†Ø¯Ù‡</th><th>Ù†ÙØ± Ú†Ù‡Ø§Ø±Ù…</th>
                    <th style="width: 65px;" class="no-export">Ø§ØµÙ„Ø§Ø­</th>
                    <th style="width: 65px;" class="no-export">Ø­Ø°Ù</th>
                </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>
    
    <div class="actions">
        <button class="btn btn-new" onclick="openModal()">+ Ø«Ø¨Øª ÙØ¹Ø§Ù„ÛŒØª Ø¬Ø¯ÛŒØ¯</button>
        <button class="btn btn-clear" onclick="clearDayData()">Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø§Ù…Ø±ÙˆØ²</button>
        <div class="spacer"></div>
        <button class="btn btn-share-direct" onclick="shareNative()">ğŸ“¤ Ø§Ø±Ø³Ø§Ù„ Ù…Ø³ØªÙ‚ÛŒÙ… Ø¨Ø±Ù†Ø§Ù…Ù‡</button>
        <button class="btn btn-img" onclick="downloadImage()">ğŸ’¾ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø¹Ú©Ø³ Ø¨Ø±Ù†Ø§Ù…Ù‡</button>
    </div>

    <div class="summary-report">
        <h3 id="summaryTitle">Ú¯Ø²Ø§Ø±Ø´ Ú©Ø§Ø±</h3>
        <div class="report-field"><label>ØªØ¹Ø¯Ø§Ø¯ Ù…Ø´Ø§ÙˆØ±<span>:</span></label><input type="number" id="stat_advisor" oninput="saveCurrentData()"></div>
        <div class="report-field"><label>Ø²Ù†Ú¯ Ø¯Ø¹ÙˆØª<span>:</span></label><input type="number" id="stat_invite" oninput="saveCurrentData()"></div>
        <div class="report-field"><label>Ù¾Ø±Ø²Ù†Øª<span>:</span></label><input type="number" id="stat_present" oninput="saveCurrentData()"></div>
        <div class="report-field"><label>Ø§Ø±ØªØ¨Ø§Ø· Ù…Ø¤Ø«Ø±<span>:</span></label><input type="number" id="stat_relation" oninput="saveCurrentData()"></div>
        <div class="report-field"><label>Ø¢Ù…ÙˆØ²Ø´<span>:</span></label><input type="number" id="stat_edu" oninput="saveCurrentData()"></div>
        <div class="report-field"><label>Ø«Ø¨Øª Ù†Ø§Ù…<span>:</span></label><input type="number" id="stat_reg" oninput="saveCurrentData()"></div>
        <div class="report-field"><label>Ø§Ù…ØªÛŒØ§Ø² Ø®Ø±ÛŒØ¯<span>:</span></label><input type="number" id="stat_point" oninput="saveCurrentData()"></div>
        <button class="btn btn-share" style="background:var(--blue-btn); width:100%; margin-top:10px;" onclick="copyReportText()">ğŸ“‹ Ú©Ù¾ÛŒ Ù…ØªÙ† Ú¯Ø²Ø§Ø±Ø´ Ú©Ø§Ø±</button>
    </div>

    <div class="backup-section">
        <button class="btn btn-backup" onclick="exportBackup()">ğŸ“¥ Ø®Ø±ÙˆØ¬ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù† (Backup)</button>
        <button class="btn btn-backup" style="background:#7f8c8d" onclick="importBackup()">ğŸ“¤ ÙˆØ§Ø±Ø¯ Ú©Ø±Ø¯Ù† Ù¾Ø´ØªÛŒØ¨Ø§Ù† (Restore)</button>
        <input type="file" id="importFile" style="display:none" onchange="processBackupFile(this)">
    </div>
</div>

<div id="planModal" class="modal">
    <div class="modal-content">
        <h3 id="modalTitle">Ø«Ø¨Øª Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø±ÙˆØ²Ø§Ù†Ù‡</h3>
        <input type="hidden" id="editIndex" value="-1">
        <div class="form-group"><label>Ù†ÙˆØ¹ Ø¨Ø±Ù†Ø§Ù…Ù‡:</label><select id="planType" onchange="toggleFields()"><option value="work">Ú©Ø§Ø±ÛŒ (Ø¬Ù„Ø³Ø§Øª Ùˆ Ø¨ÛŒØ²Ù†Ø³)</option><option value="personal">Ø´Ø®ØµÛŒ (Ø§Ø³ØªØ±Ø§Ø­Øª Ùˆ ØºÛŒØ±Ù‡)</option></select></div>
        <div class="form-group"><label>Ø¹Ù†ÙˆØ§Ù† Ø¨Ø±Ù†Ø§Ù…Ù‡:</label><input type="text" id="title" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø¬Ù„Ø³Ù‡ Ù¾Ø±Ø²Ù†Øª"></div>
        <div id="workFields">
            <div class="form-group"><label>Ù…Ø®Ø§Ø·Ø¨ Ø¬Ù„Ø³Ù‡:</label><input type="text" id="audience"></div>
            <div class="form-group"><label>Ù…Ø¹Ø±Ù:</label><input type="text" id="ref"></div>
            <div class="form-group"><label>Ù…Ú©Ø§Ù†:</label><input type="text" id="location"></div>
            <div class="form-group"><label>Ø¨Ø±Ú¯Ø²Ø§Ø±Ú©Ù†Ù†Ø¯Ù‡:</label><input type="text" id="organizer"></div>
            <div class="form-group"><label>Ù†ÙØ± Ú†Ù‡Ø§Ø±Ù…:</label><input type="text" id="fourthPerson"></div>
        </div>
        <div class="form-group"><label>Ø³Ø§Ø¹Øª:</label><input type="time" id="time"></div>
        <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
            <button class="btn btn-clear" onclick="closeModal()">Ø§Ù†ØµØ±Ø§Ù</button>
            <button class="btn btn-new" onclick="saveEntry()">ØªØ§ÛŒÛŒØ¯ Ùˆ Ø°Ø®ÛŒØ±Ù‡</button>
        </div>
    </div>
</div>

<script>
    function initSelectors() {
        const d = document.getElementById('selDay'), m = document.getElementById('selMonth'), y = document.getElementById('selYear');
        for(let i=1; i<=31; i++) d.options.add(new Option(i<10?'0'+i:i, i<10?'0'+i:i));
        for(let i=1; i<=12; i++) m.options.add(new Option(i<10?'0'+i:i, i<10?'0'+i:i));
        for(let i=1404; i<=1406; i++) y.options.add(new Option(i, i));
        
        const last = localStorage.getItem('lastDateKey');
        if(last) {
            const p = last.split('_'); y.value = p[1]; m.value = p[2]; d.value = p[3];
        } else {
            y.value = "1404"; m.value = "11"; d.value = "11";
            document.getElementById('selDayName').value = "Ø´Ù†Ø¨Ù‡";
        }
    }

    function getStorageKey() { return `data_${document.getElementById('selYear').value}_${document.getElementById('selMonth').value}_${document.getElementById('selDay').value}`; }
    function handleDateChange() { loadData(getStorageKey()); }

    function loadData(key) {
        const raw = localStorage.getItem(key);
        const data = raw ? JSON.parse(raw) : { owner: localStorage.getItem('lastOwner')||"", dayName: "Ø´Ù†Ø¨Ù‡", note: "", stats: {}, plans: [] };
        document.getElementById('ownerName').value = data.owner;
        document.getElementById('selDayName').value = data.dayName;
        document.getElementById('extraNote').value = data.note;
        const s = data.stats || {};
        ['advisor', 'invite', 'present', 'relation', 'edu', 'reg', 'point'].forEach(f => document.getElementById('stat_'+f).value = s[f] || "");
        renderTable(data.plans || []);
        updateSummaryTitle();
    }

    function saveCurrentData() {
        const key = getStorageKey();
        const cur = JSON.parse(localStorage.getItem(key)) || { plans: [] };
        const data = {
            owner: document.getElementById('ownerName').value, dayName: document.getElementById('selDayName').value, note: document.getElementById('extraNote').value,
            stats: { advisor: document.getElementById('stat_advisor').value, invite: document.getElementById('stat_invite').value, present: document.getElementById('stat_present').value, relation: document.getElementById('stat_relation').value, edu: document.getElementById('stat_edu').value, reg: document.getElementById('stat_reg').value, point: document.getElementById('stat_point').value },
            plans: cur.plans
        };
        localStorage.setItem(key, JSON.stringify(data));
        localStorage.setItem('lastOwner', data.owner);
        localStorage.setItem('lastDateKey', key);
        updateSummaryTitle();
    }

    function renderTable(plans) {
        const tbody = document.getElementById('tableBody');
        tbody.innerHTML = "";
        plans.forEach((item, index) => {
            const isWork = item.type === 'work';
            const rowClass = isWork ? 'row-work' : 'row-personal';
            const dash = "-------";
            let icon = item.status === 'check' ? 'âœ”' : (item.status === 'cross' ? 'âœ–' : '');
            let statusCls = item.status === 'check' ? 'status-check' : (item.status === 'cross' ? 'status-cross' : '');
            
            tbody.innerHTML += `<tr class="${rowClass}">
                <td>${index+1}</td>
                <td class="status-cell ${statusCls}" onclick="cycleStatus(${index})">${icon}</td>
                <td>${item.title}</td>
                <td>${isWork ? item.audience : dash}</td>
                <td>${isWork ? item.ref : dash}</td>
                <td>${item.time}</td>
                <td>${isWork ? item.location : dash}</td>
                <td>${isWork ? item.organizer : dash}</td>
                <td>${isWork ? item.fourthPerson : dash}</td>
                <td class="no-export"><button class="btn btn-edit" onclick="openModal(${index})">Ø§ØµÙ„Ø§Ø­</button></td>
                <td class="no-export"><button class="btn btn-delete" onclick="deleteRow(${index})">Ø­Ø°Ù</button></td>
            </tr>`;
        });
    }

    function cycleStatus(idx) {
        let d = JSON.parse(localStorage.getItem(getStorageKey()));
        let s = d.plans[idx].status;
        if (!s) d.plans[idx].status = 'check';
        else if (s === 'check') d.plans[idx].status = 'cross';
        else d.plans[idx].status = '';
        localStorage.setItem(getStorageKey(), JSON.stringify(d));
        renderTable(d.plans);
    }

    async function generateBlob() {
        const area = document.getElementById('capture-area');
        document.querySelectorAll('.no-export').forEach(e => e.style.display = 'none');
        const canvas = await html2canvas(area, { scale: 2 });
        document.querySelectorAll('.no-export').forEach(e => e.style.display = '');
        return new Promise(resolve => canvas.toBlob(resolve, 'image/jpeg', 0.95));
    }

    async function downloadImage() {
        const blob = await generateBlob();
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `Schedule_${getStorageKey()}.jpg`;
        link.click();
    }

    async function shareNative() {
        const blob = await generateBlob();
        const file = new File([blob], "plan.jpg", { type: 'image/jpeg' });
        if (navigator.canShare && navigator.canShare({ files: [file] })) {
            navigator.share({ files: [file], title: 'Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø±ÙˆØ²Ø§Ù†Ù‡' });
        } else {
            alert("Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ù…Ø³ØªÙ‚ÛŒÙ… Ø¯Ø± Ø§ÛŒÙ† Ø¯Ø³ØªÚ¯Ø§Ù‡ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ Ù†Ù…ÛŒâ€ŒØ´ÙˆØ¯. Ù„Ø·ÙØ§Ù‹ Ø¹Ú©Ø³ Ø±Ø§ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ú©Ù†ÛŒØ¯.");
        }
    }

    function exportBackup() {
        let b = {}; for(let i=0; i<localStorage.length; i++) b[localStorage.key(i)] = localStorage.getItem(localStorage.key(i));
        const blob = new Blob([JSON.stringify(b)], {type: "text/plain"});
        const link = document.createElement('a'); link.href = URL.createObjectURL(blob); link.download = "Full_Backup.txt"; link.click();
    }

    function importBackup() { document.getElementById('importFile').click(); }
    function processBackupFile(inp) {
        const r = new FileReader(); r.onload = (e) => {
            try { 
                const d = JSON.parse(e.target.result); 
                if(confirm("Ù‡Ø´Ø¯Ø§Ø±: ØªÙ…Ø§Ù… Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙØ¹Ù„ÛŒ Ø¨Ø§ Ø§ÛŒÙ† ÙØ§ÛŒÙ„ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ù…ÛŒâ€ŒØ´ÙˆØ¯. Ø§Ø¯Ø§Ù…Ù‡ Ù…ÛŒâ€ŒØ¯Ù‡ÛŒØ¯ØŸ")) { localStorage.clear(); for(let k in d) localStorage.setItem(k, d[k]); location.reload(); }
            } catch { alert("ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª."); }
        }; r.readAsText(inp.files[0]);
    }

    function saveEntry() {
        const k = getStorageKey(); const idx = parseInt(document.getElementById('editIndex').value);
        let d = JSON.parse(localStorage.getItem(k)) || { stats:{}, plans:[] };
        const row = {
            title: document.getElementById('title').value, audience: document.getElementById('audience').value,
            ref: document.getElementById('ref').value, time: document.getElementById('time').value,
            location: document.getElementById('location').value, organizer: document.getElementById('organizer').value,
            fourthPerson: document.getElementById('fourthPerson').value, type: document.getElementById('planType').value,
            status: idx > -1 ? d.plans[idx].status : ""
        };
        if(!row.title || !row.time) { alert("Ù„Ø·ÙØ§Ù‹ Ø¹Ù†ÙˆØ§Ù† Ùˆ Ø³Ø§Ø¹Øª Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯."); return; }
        if(idx > -1) d.plans[idx] = row; else d.plans.push(row);
        d.plans.sort((a,b) => a.time.localeCompare(b.time));
        localStorage.setItem(k, JSON.stringify(d)); renderTable(d.plans); closeModal();
    }

    function updateSummaryTitle() {
        const d = document.getElementById('selDay').value, m = document.getElementById('selMonth').value, y = document.getElementById('selYear').value;
        document.getElementById('summaryTitle').innerText = `Ú¯Ø²Ø§Ø±Ø´ Ú©Ø§Ø± ${document.getElementById('selDayName').value} ${y}/${m}/${d}`;
    }
    function copyReportText() {
        const g = (id) => document.getElementById(id).value || "0";
        const t = `Ú¯Ø²Ø§Ø±Ø´ Ú©Ø§Ø± ${document.getElementById('selDayName').value} ${getStorageKey().replace('data_','')}\nØªØ¹Ø¯Ø§Ø¯ Ù…Ø´Ø§ÙˆØ±: ${g('stat_advisor')}\nØ²Ù†Ú¯ Ø¯Ø¹ÙˆØª: ${g('stat_invite')}\nÙ¾Ø±Ø²Ù†Øª: ${g('stat_present')}\nØ§Ø±ØªØ¨Ø§Ø· Ù…ÙˆØ«Ø±: ${g('stat_relation')}\nØ¢Ù…ÙˆØ²Ø´: ${g('stat_edu')}\nØ«Ø¨Øªâ€ŒÙ†Ø§Ù…: ${g('stat_reg')}\nØ§Ù…ØªÛŒØ§Ø² Ø®Ø±ÛŒØ¯: ${g('stat_point')}`;
        navigator.clipboard.writeText(t); alert("Ù…ØªÙ† Ú¯Ø²Ø§Ø±Ø´ Ú©Ù¾ÛŒ Ø´Ø¯.");
    }
    function openModal(i = -1) { 
        document.getElementById('planModal').style.display="block";
        if(i > -1) {
            const d = (JSON.parse(localStorage.getItem(getStorageKey()))).plans[i];
            document.getElementById('editIndex').value = i;
            ['title', 'audience', 'ref', 'time', 'location', 'organizer', 'fourthPerson', 'planType'].forEach(f => document.getElementById(f).value = d[f]);
        } else { document.getElementById('editIndex').value = "-1"; document.querySelectorAll('#planModal input').forEach(inp=>inp.value=""); }
        toggleFields();
    }
    function closeModal() { document.getElementById('planModal').style.display="none"; }
    function toggleFields() {
        const isP = document.getElementById('planType').value === 'personal';
        document.querySelectorAll('#workFields input').forEach(i => { i.disabled = isP; i.style.background = isP ? "#eee" : "#fff"; });
    }
    function deleteRow(i) { if(confirm("Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ù…ÙˆØ±Ø¯ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ")) { let d = JSON.parse(localStorage.getItem(getStorageKey())); d.plans.splice(i,1); localStorage.setItem(getStorageKey(), JSON.stringify(d)); renderTable(d.plans); } }
    function clearDayData() { if(confirm("ØªÙ…Ø§Ù… Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø«Ø¨Øª Ø´Ø¯Ù‡ Ø¨Ø±Ø§ÛŒ Ø§Ù…Ø±ÙˆØ² Ù¾Ø§Ú© Ø´ÙˆØ¯ØŸ")) { localStorage.removeItem(getStorageKey()); handleDateChange(); } }
    window.onload = () => { initSelectors(); handleDateChange(); };
</script>
</body>
</html>
