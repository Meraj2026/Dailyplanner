<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¯ÙØªØ±Ú†Ù‡ Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ</title>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Vazirmatn', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .page {
            width: 210mm;
            min-height: 297mm;
            background: white;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            position: relative;
            border-radius: 8px;
            overflow: hidden;
        }

        .page::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 6px;
            background: linear-gradient(90deg, #4a90e2, #5cb85c, #f0ad4e);
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eaeaea;
            flex-wrap: wrap;
            gap: 10px;
        }

        .header-input {
            border: 1px solid #ddd;
            padding: 10px 12px;
            border-radius: 6px;
            font-family: inherit;
            font-size: 14px;
            transition: all 0.3s;
            background: #f9f9f9;
        }

        .header-input:focus {
            outline: none;
            border-color: #4a90e2;
            box-shadow: 0 0 0 3px rgba(74, 144, 226, 0.1);
            background: white;
        }

        #ownerName {
            flex: 1;
            min-width: 200px;
            font-weight: 500;
        }

        #date {
            width: 150px;
            text-align: center;
        }

        #day {
            width: 120px;
            text-align: center;
            background: #e8f4fd;
            color: #2c6eb5;
            font-weight: 500;
        }

        .table-section {
            margin-bottom: 25px;
        }

        .table-container {
            overflow-x: auto;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1200px;
        }

        th {
            background: linear-gradient(135deg, #4a90e2, #357ae8);
            color: white;
            padding: 12px 8px;
            text-align: center;
            font-weight: 500;
            font-size: 13px;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        td {
            border: 1px solid #eee;
            padding: 10px 8px;
            text-align: center;
            font-size: 12px;
            vertical-align: middle;
            transition: background 0.2s;
        }

        tr:hover td {
            background-color: #f8f9ff;
        }

        td[contenteditable="true"]:focus {
            background: #fff;
            outline: 2px solid #4a90e2;
            outline-offset: -2px;
            border-radius: 4px;
        }

        .action-btn {
            padding: 4px 10px;
            margin: 0 2px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            font-family: inherit;
            transition: all 0.2s;
        }

        .edit-btn {
            background: #5cb85c;
            color: white;
        }

        .edit-btn:hover {
            background: #4cae4c;
        }

        .delete-btn {
            background: #d9534f;
            color: white;
        }

        .delete-btn:hover {
            background: #c9302c;
        }

        .button-group {
            display: flex;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .main-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-family: inherit;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .download-btn {
            background: linear-gradient(135deg, #f0ad4e, #ec971f);
            color: white;
        }

        .share-btn {
            background: linear-gradient(135deg, #5bc0de, #31b0d5);
            color: white;
        }

        .main-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
        }

        .bottom-section {
            display: flex;
            gap: 20px;
            margin-top: 25px;
            min-height: 300px;
        }

        .column {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .box {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            background: #fafafa;
            flex: 1;
            display: flex;
            flex-direction: column;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .box h3 {
            margin-bottom: 12px;
            color: #333;
            font-size: 14px;
            border-bottom: 2px solid #4a90e2;
            padding-bottom: 6px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .task-list {
            list-style: none;
            flex: 1;
            overflow-y: auto;
            max-height: 150px;
            margin-bottom: 10px;
        }

        .task-item {
            padding: 8px 10px;
            margin-bottom: 6px;
            background: white;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid #eaeaea;
            transition: all 0.2s;
        }

        .task-item:hover {
            border-color: #4a90e2;
            transform: translateX(2px);
        }

        .task-title {
            flex: 1;
            font-size: 13px;
        }

        .task-time {
            color: #666;
            font-size: 12px;
            margin-left: 10px;
            background: #f0f0f0;
            padding: 2px 6px;
            border-radius: 3px;
        }

        .task-actions {
            display: flex;
            gap: 4px;
        }

        .task-btn {
            padding: 2px 6px;
            font-size: 11px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }

        .add-task {
            display: flex;
            gap: 8px;
            margin-top: auto;
        }

        .add-task input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: inherit;
            font-size: 13px;
        }

        .add-task button {
            padding: 8px 12px;
            background: #4a90e2;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-family: inherit;
            transition: background 0.2s;
        }

        .add-task button:hover {
            background: #357ae8;
        }

        .report-box {
            background: linear-gradient(to bottom, #ffffff, #f8f9fa);
        }

        .report-date {
            color: #4a90e2;
            font-weight: bold;
            margin-right: 10px;
        }

        .report-fields {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 15px 0;
        }

        .report-field {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px;
            background: white;
            border-radius: 4px;
            border: 1px solid #eaeaea;
        }

        .report-field label {
            font-size: 13px;
            color: #555;
        }

        .report-field input {
            width: 70px;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
            font-family: inherit;
        }

        .report-field input:focus {
            outline: none;
            border-color: #4a90e2;
        }

        .backup-section {
            margin-top: 25px;
            padding-top: 15px;
            border-top: 1px dashed #ddd;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .backup-btn {
            padding: 8px 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: #f8f9fa;
            cursor: pointer;
            font-family: inherit;
            font-size: 13px;
            transition: all 0.2s;
        }

        .backup-btn:hover {
            background: #e9ecef;
            border-color: #ccc;
        }

        .empty-message {
            text-align: center;
            color: #999;
            padding: 20px;
            font-style: italic;
            font-size: 13px;
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }
            .page {
                box-shadow: none;
                width: 100%;
                padding: 15px;
            }
            .button-group, .backup-section, .add-task button, .task-actions, .action-btn {
                display: none;
            }
            .header-input, .report-field input, td[contenteditable] {
                border: 1px solid #ddd;
                background: transparent;
            }
        }

        /* Ø§Ø³Ú©Ø±ÙˆÙ„ Ø¨Ø§Ø± Ø²ÛŒØ¨Ø§ */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
    </style>
</head>
<body>
    <div class="page" id="plannerPage">
        <header>
            <input type="text" id="ownerName" class="header-input" placeholder="Ù†Ø§Ù… ØµØ§Ø­Ø¨ Ø¨Ø±Ù†Ø§Ù…Ù‡">
            <input type="date" id="date" class="header-input">
            <input type="text" id="day" class="header-input" readonly>
        </header>

        <div class="table-section">
            <div class="table-container">
                <table id="scheduleTable">
                    <thead>
                        <tr>
                            <th>Ø±Ø¯ÛŒÙ</th>
                            <th>Ù†ØªÛŒØ¬Ù‡</th>
                            <th>Ø¹Ù†ÙˆØ§Ù† Ø¬Ù„Ø³Ù‡</th>
                            <th>Ù…Ø®Ø§Ø·Ø¨</th>
                            <th>Ù…Ø¹Ø±Ù</th>
                            <th>Ø³Ø§Ø¹Øª</th>
                            <th>Ù…Ú©Ø§Ù†</th>
                            <th>Ø¨Ø±Ú¯Ø²Ø§Ø±Ú©Ù†Ù†Ø¯Ù‡</th>
                            <th>Ù†ÙØ± Ú†Ù‡Ø§Ø±Ù…</th>
                            <th>ÙˆÛŒØ±Ø§ÛŒØ´</th>
                            <th>Ø­Ø°Ù</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <!-- Ø±Ø¯ÛŒÙâ€ŒÙ‡Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø¯Ø§ÛŒÙ†Ø§Ù…ÛŒÚ© -->
                    </tbody>
                </table>
            </div>
            <div class="button-group">
                <button id="addRowBtn" class="main-btn">â• Ø§ÙØ²ÙˆØ¯Ù† Ø±Ø¯ÛŒÙ</button>
                <button id="downloadBtn" class="main-btn download-btn">ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯ JPG</button>
                <button id="shareTableBtn" class="main-btn share-btn">ğŸ”— Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¬Ø¯ÙˆÙ„</button>
            </div>
        </div>

        <div class="bottom-section">
            <div class="column">
                <div class="box">
                    <h3>ğŸ“‹ Ù„ÛŒØ³Øª Ú©Ø§Ø±Ù‡Ø§ÛŒÛŒ Ú©Ù‡ Ø¨Ø§ÛŒØ¯ Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ Ø´ÙˆØ¯</h3>
                    <ul id="planList" class="task-list"></ul>
                    <div class="add-task">
                        <input type="text" id="planTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ú©Ø§Ø±">
                        <input type="time" id="planTime">
                        <button id="addPlanBtn">Ø§ÙØ²ÙˆØ¯Ù†</button>
                    </div>
                </div>
                <div class="box">
                    <h3>ğŸ“¤ Ù„ÛŒØ³Øª Ú©Ø§Ø±Ù‡Ø§ÛŒÛŒ Ú©Ù‡ Ø¨Ø§ÛŒØ¯ ÙˆØ§Ú¯Ø°Ø§Ø± Ø´ÙˆØ¯</h3>
                    <ul id="delegateList" class="task-list"></ul>
                    <div class="add-task">
                        <input type="text" id="delegateTitle" placeholder="Ø¹Ù†ÙˆØ§Ù† Ú©Ø§Ø±">
                        <input type="time" id="delegateTime">
                        <button id="addDelegateBtn">Ø§ÙØ²ÙˆØ¯Ù†</button>
                    </div>
                </div>
            </div>

            <div class="column">
                <div class="box report-box">
                    <h3>ğŸ“Š Ú¯Ø²Ø§Ø±Ø´ Ú©Ø§Ø± <span id="reportDate" class="report-date"></span></h3>
                    <div class="report-fields">
                        <div class="report-field">
                            <label>ØªØ¹Ø¯Ø§Ø¯ Ù…Ø´Ø§ÙˆØ±Ø§Ù†</label>
                            <input type="number" id="advisors" min="0" value="0">
                        </div>
                        <div class="report-field">
                            <label>Ø²Ù†Ú¯ Ø¯Ø¹ÙˆØª</label>
                            <input type="number" id="invites" min="0" value="0">
                        </div>
                        <div class="report-field">
                            <label>Ù¾Ø±Ø²Ù†Øª</label>
                            <input type="number" id="present" min="0" value="0">
                        </div>
                        <div class="report-field">
                            <label>Ø§Ø±ØªØ¨Ø§Ø· Ù…Ø¤Ø«Ø±</label>
                            <input type="number" id="effectiveCommunication" min="0" value="0">
                        </div>
                        <div class="report-field">
                            <label>Ø¢Ù…ÙˆØ²Ø´</label>
                            <input type="number" id="training" min="0" value="0">
                        </div>
                        <div class="report-field">
                            <label>Ø«Ø¨Øª Ù†Ø§Ù…</label>
                            <input type="number" id="registration" min="0" value="0">
                        </div>
                        <div class="report-field">
                            <label>Ø§Ù…ØªÛŒØ§Ø² Ø®Ø±ÛŒØ¯</label>
                            <input type="number" id="purchaseScore" min="0" value="0">
                        </div>
                    </div>
                    <button id="shareReportBtn" class="main-btn share-btn">ğŸ“¤ Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ú¯Ø²Ø§Ø±Ø´</button>
                </div>
            </div>
        </div>

        <div class="backup-section">
            <button id="backupBtn" class="backup-btn">ğŸ’¾ Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ Ú©Ù„ÛŒ</button>
            <button id="restoreBtn" class="backup-btn">ğŸ“‚ Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†</button>
            <input type="file" id="restoreFile" accept=".json" style="display: none">
        </div>
    </div>

    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script>
        // ØªØ¨Ø¯ÛŒÙ„ ØªØ§Ø±ÛŒØ® Ù…ÛŒÙ„Ø§Ø¯ÛŒ Ø¨Ù‡ Ø´Ù…Ø³ÛŒ (Ø³Ø§Ø¯Ù‡)
        function toJalali(dateStr) {
            const date = new Date(dateStr);
            const jd = Math.floor((date.getTime() / 86400000) + 2440587.5);
            const depoch = jd - 1948320.5;
            const cycle = Math.floor(depoch / 1029983);
            const cyear = depoch % 1029983;
            const ycycle = Math.floor(cyear / 366);
            const year = cycle * 2820 + ycycle * 1025 + (cyear % 366);
            let month, day;
            if (jd >= 2452674.5) {
                month = Math.floor((jd - 2415021.5) / 354.367) % 12;
                day = jd - 2415021.5 - Math.floor(month * 354.367) + 1;
            } else {
                month = Math.floor((jd - 2415021.5) / 354.367) % 12;
                day = jd - 2415021.5 - Math.floor(month * 354.367) + 1;
            }
            return `${year}/${month + 1}/${Math.floor(day)}`;
        }

        function getDayOfWeek(dateStr) {
            const days = ['ÛŒÚ©â€ŒØ´Ù†Ø¨Ù‡', 'Ø¯ÙˆØ´Ù†Ø¨Ù‡', 'Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡', 'Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡', 'Ù¾Ù†Ø¬â€ŒØ´Ù†Ø¨Ù‡', 'Ø¬Ù…Ø¹Ù‡', 'Ø´Ù†Ø¨Ù‡'];
            return days[new Date(dateStr).getDay()];
        }

        // Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§
        let currentDate = new Date().toISOString().split('T')[0];
        let appData = {};

        function loadData() {
            const saved = localStorage.getItem('plannerData');
            if (saved) appData = JSON.parse(saved);
            loadDateData(currentDate);
        }

        function saveData() {
            localStorage.setItem('plannerData', JSON.stringify(appData));
        }

        function loadDateData(date) {
            currentDate = date;
            const dateData = appData[date] || getEmptyDateData();
            
            // Ù‡Ø¯Ø±
            document.getElementById('date').value = date;
            document.getElementById('day').value = getDayOfWeek(date);
            document.getElementById('ownerName').value = localStorage.getItem('ownerName') || '';
            
            // Ø¬Ø¯ÙˆÙ„
            renderTable(dateData.tableRows);
            
            // Ù„ÛŒØ³Øªâ€ŒÙ‡Ø§
            renderTaskList('planList', dateData.planTasks);
            renderTaskList('delegateList', dateData.delegateTasks);
            
            // Ú¯Ø²Ø§Ø±Ø´
            renderReport(dateData.report);
        }

        function getEmptyDateData() {
            return {
                tableRows: [],
                planTasks: [],
                delegateTasks: [],
                report: {
                    advisors: 0,
                    invites: 0,
                    present: 0,
                    effectiveCommunication: 0,
                    training: 0,
                    registration: 0,
                    purchaseScore: 0
                }
            };
        }

        function getCurrentDateData() {
            return appData[currentDate] || getEmptyDateData();
        }

        // Ø¬Ø¯ÙˆÙ„
        function renderTable(rows) {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            rows.forEach((row, index) => {
                const tr = document.createElement('tr');
                tr.dataset.id = row.id || Date.now() + Math.random();
                tr.innerHTML = `
                    <td>${index + 1}</td>
                    <td contenteditable="true" class="editable">${row.result || ''}</td>
                    <td contenteditable="true" class="editable">${row.title || ''}</td>
                    <td contenteditable="true" class="editable">${row.audience || ''}</td>
                    <td contenteditable="true" class="editable">${row.introducer || ''}</td>
                    <td contenteditable="true" class="editable">${row.time || ''}</td>
                    <td contenteditable="true" class="editable">${row.location || ''}</td>
                    <td contenteditable="true" class="editable">${row.organizer || ''}</td>
                    <td contenteditable="true" class="editable">${row.fourth || ''}</td>
                    <td><button class="action-btn edit-btn" onclick="editRow(this)">ÙˆÛŒØ±Ø§ÛŒØ´</button></td>
                    <td><button class="action-btn delete-btn" onclick="deleteRow(this)">Ø­Ø°Ù</button></td>
                `;
                tbody.appendChild(tr);
            });
            updateRowNumbers();
        }

        function updateRowNumbers() {
            document.querySelectorAll('#tableBody tr').forEach((tr, index) => {
                tr.querySelector('td:first-child').textContent = index + 1;
            });
        }

        function getTableRows() {
            const rows = [];
            document.querySelectorAll('#tableBody tr').forEach(tr => {
                const cells = tr.querySelectorAll('td');
                rows.push({
                    id: tr.dataset.id,
                    result: cells[1].innerText.trim(),
                    title: cells[2].innerText.trim(),
                    audience: cells[3].innerText.trim(),
                    introducer: cells[4].innerText.trim(),
                    time: cells[5].innerText.trim(),
                    location: cells[6].innerText.trim(),
                    organizer: cells[7].innerText.trim(),
                    fourth: cells[8].innerText.trim()
                });
            });
            return rows;
        }

        document.getElementById('addRowBtn').addEventListener('click', () => {
            const data = getCurrentDateData();
            data.tableRows.push({
                id: Date.now(),
                result: '',
                title: '',
                audience: '',
                introducer: '',
                time: '',
                location: '',
                organizer: '',
                fourth: ''
            });
            appData[currentDate] = data;
            renderTable(data.tableRows);
            saveData();
        });

        function editRow(btn) {
            const tr = btn.closest('tr');
            const cells = tr.querySelectorAll('td');
            const startIndex = 1;
            const endIndex = 9;
            
            let allEditable = true;
            for (let i = startIndex; i < endIndex; i++) {
                if (cells[i].contentEditable === 'true') {
                    allEditable = false;
                    break;
                }
            }
            
            for (let i = startIndex; i < endIndex; i++) {
                cells[i].contentEditable = allEditable ? 'true' : 'false';
                if (allEditable) cells[i].focus();
            }
            
            btn.textContent = allEditable ? 'Ø°Ø®ÛŒØ±Ù‡' : 'ÙˆÛŒØ±Ø§ÛŒØ´';
            if (!allEditable) saveData();
        }

        function deleteRow(btn) {
            if (confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ø±Ø¯ÛŒÙ Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ')) {
                const tr = btn.closest('tr');
                tr.remove();
                saveData();
                updateRowNumbers();
            }
        }

        // Ù„ÛŒØ³Øª Ú©Ø§Ø±Ù‡Ø§
        function renderTaskList(elementId, tasks) {
            const ul = document.getElementById(elementId);
            ul.innerHTML = '';
            if (tasks.length === 0) {
                ul.innerHTML = '<li class="empty-message">Ù‡ÛŒÚ† Ú©Ø§Ø±ÛŒ Ø§Ø¶Ø§ÙÙ‡ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª</li>';
                return;
            }
            tasks.forEach((task, index) => {
                const li = document.createElement('li');
                li.className = 'task-item';
                li.innerHTML = `
                    <span class="task-title">${task.title}</span>
                    <span class="task-time">${task.time}</span>
                    <div class="task-actions">
                        <button class="task-btn delete-btn" onclick="deleteTask('${elementId}', ${index})">Ø­Ø°Ù</button>
                    </div>
                `;
                ul.appendChild(li);
            });
        }

        function getTaskList(elementId) {
            const tasks = [];
            document.querySelectorAll(`#${elementId} .task-item`).forEach(li => {
                tasks.push({
                    title: li.querySelector('.task-title').innerText.trim(),
                    time: li.querySelector('.task-time').innerText.trim()
                });
            });
            return tasks;
        }

        function deleteTask(listId, index) {
            const data = getCurrentDateData();
            if (listId === 'planList') {
                data.planTasks.splice(index, 1);
            } else {
                data.delegateTasks.splice(index, 1);
            }
            appData[currentDate] = data;
            renderTaskList(listId, listId === 'planList' ? data.planTasks : data.delegateTasks);
            saveData();
        }

        function addTask(listId, titleInputId, timeInputId) {
            const title = document.getElementById(titleInputId).value.trim();
            const time = document.getElementById(timeInputId).value;
            if (!title || !time) {
                alert('Ù„Ø·ÙØ§Ù‹ Ø¹Ù†ÙˆØ§Ù† Ùˆ Ø²Ù…Ø§Ù† Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
                return;
            }
            const data = getCurrentDateData();
            if (listId === 'planList') {
                data.planTasks.push({ title, time });
            } else {
                data.delegateTasks.push({ title, time });
            }
            appData[currentDate] = data;
            renderTaskList(listId, listId === 'planList' ? data.planTasks : data.delegateTasks);
            document.getElementById(titleInputId).value = '';
            document.getElementById(timeInputId).value = '';
            saveData();
        }

        document.getElementById('addPlanBtn').addEventListener('click', () => 
            addTask('planList', 'planTitle', 'planTime'));
        document.getElementById('addDelegateBtn').addEventListener('click', () => 
            addTask('delegateList', 'delegateTitle', 'delegateTime'));

        // Ú¯Ø²Ø§Ø±Ø´
        function renderReport(report) {
            document.getElementById('advisors').value = report.advisors || 0;
            document.getElementById('invites').value = report.invites || 0;
            document.getElementById('present').value = report.present || 0;
            document.getElementById('effectiveCommunication').value = report.effectiveCommunication || 0;
            document.getElementById('training').value = report.training || 0;
            document.getElementById('registration').value = report.registration || 0;
            document.getElementById('purchaseScore').value = report.purchaseScore || 0;
            document.getElementById('reportDate').textContent = toJalali(currentDate);
        }

        function getReportData() {
            return {
                advisors: document.getElementById('advisors').value,
                invites: document.getElementById('invites').value,
                present: document.getElementById('present').value,
                effectiveCommunication: document.getElementById('effectiveCommunication').value,
                training: document.getElementById('training').value,
                registration: document.getElementById('registration').value,
                purchaseScore: document.getElementById('purchaseScore').value
            };
        }

        // Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ú¯Ø²Ø§Ø±Ø´
        document.getElementById('shareReportBtn').addEventListener('click', async () => {
            const report = getReportData();
            const text = `Ø³Ù„Ø§Ù… Ùˆ Ø®Ø¯Ø§ Ù‚ÙˆØª ğŸŒº

Ú¯Ø²Ø§Ø±Ø´ Ú©Ø§Ø±

${toJalali(currentDate)}

ØªØ¹Ø¯Ø§Ø¯ Ù…Ø´Ø§ÙˆØ±Ø§Ù†: ${report.advisors}

Ø²Ù†Ù€Ú¯ Ø¯Ø¹Ù€Ù€Ù€Ù€Ù€ÙˆØª: ${report.invites}

Ù¾Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ø±Ø²Ù†Ù€Ù€Øª: ${report.present}

Ø§Ø±ØªÙ€Ù€Ø¨Ø§Ø· Ù…Ù€Ù€Ù€ÙˆØ«Ø±: ${report.effectiveCommunication}

Ø¢Ù…Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ù€ÙˆØ²Ø´: ${report.training}

Ø«Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ø¨Øª Ù†Ù€Ù€Ù€Ù€Ø§Ù…: ${report.registration}

Ø§Ù…Ù€ØªÛŒØ§Ø² Ø®Ù€Ù€Ù€Ø±ÛŒØ¯: ${report.purchaseScore}`;
            
            if (navigator.share) {
                try {
                    await navigator.share({ title: 'Ú¯Ø²Ø§Ø±Ø´ Ú©Ø§Ø±', text: text });
                } catch (err) {
                    copyToClipboard(text);
                }
            } else {
                copyToClipboard(text);
            }
        });

        // Ø§Ø´ØªØ±Ø§Ú©â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¬Ø¯ÙˆÙ„
        document.getElementById('shareTableBtn').addEventListener('click', async () => {
            const rows = getTableRows();
            let text = 'Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ Ø§Ù…Ø±ÙˆØ²:\n\n';
            rows.forEach((row, index) => {
                if (row.title) {
                    text += `${index + 1}. ${row.title}\n`;
                    text += `   Ø²Ù…Ø§Ù†: ${row.time || '---'} | Ù…Ú©Ø§Ù†: ${row.location || '---'}\n`;
                    text += `   Ù…Ø®Ø§Ø·Ø¨: ${row.audience || '---'} | Ø¨Ø±Ú¯Ø²Ø§Ø±Ú©Ù†Ù†Ø¯Ù‡: ${row.organizer || '---'}\n\n`;
                }
            });
            
            if (navigator.share) {
                try {
                    await navigator.share({ title: 'Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ', text: text });
                } catch (err) {
                    copyToClipboard(text);
                }
            } else {
                copyToClipboard(text);
            }
        });

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('Ù…ØªÙ† Ú©Ù¾ÛŒ Ø´Ø¯! Ø§Ú©Ù†ÙˆÙ† Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¯Ø± Ù¾ÛŒØ§Ù…â€ŒØ±Ø³Ø§Ù† Ø®ÙˆØ¯ paste Ú©Ù†ÛŒØ¯.');
            }).catch(() => {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('Ù…ØªÙ† Ú©Ù¾ÛŒ Ø´Ø¯! Ø§Ú©Ù†ÙˆÙ† Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¯Ø± Ù¾ÛŒØ§Ù…â€ŒØ±Ø³Ø§Ù† Ø®ÙˆØ¯ paste Ú©Ù†ÛŒØ¯.');
            });
        }

        // Ø¯Ø§Ù†Ù„ÙˆØ¯ JPG
        document.getElementById('downloadBtn').addEventListener('click', () => {
            const page = document.getElementById('plannerPage');
            html2canvas(page, {
                scale: 2,
                backgroundColor: '#ffffff',
                logging: false
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = `planner-${currentDate}.jpg`;
                link.href = canvas.toDataURL('image/jpeg', 0.95);
                link.click();
            });
        });

        // Ù¾Ø´ØªÛŒØ¨Ø§Ù†â€ŒÚ¯ÛŒØ±ÛŒ
        document.getElementById('backupBtn').addEventListener('click', () => {
            const backup = JSON.stringify(appData);
            const blob = new Blob([backup], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `planner-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        });

        // Ø¨Ø§Ø²ÛŒØ§Ø¨ÛŒ
        document.getElementById('restoreBtn').addEventListener('click', () => {
            document.getElementById('restoreFile').click();
        });

        document.getElementById('restoreFile').addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    const restored = JSON.parse(event.target.result);
                    if (confirm('Ø¢ÛŒØ§ Ø§Ø² Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ Ø§ÛŒÙ† Ø¹Ù…Ù„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ ÙØ¹Ù„ÛŒ Ø±Ø§ Ø¨Ø§Ø²Ù†ÙˆÛŒØ³ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ø¯.')) {
                        appData = restored;
                        saveData();
                        loadDateData(currentDate);
                        alert('Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†ÛŒ Ø´Ø¯.');
                    }
                } catch (err) {
                    alert('ÙØ§ÛŒÙ„ Ù¾Ø´ØªÛŒØ¨Ø§Ù† Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª.');
                }
            };
            reader.readAsText(file);
            e.target.value = '';
        });

        // Ø°Ø®ÛŒØ±Ù‡ Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ ÙˆÛŒØ±Ø§ÛŒØ´ÛŒ
        document.addEventListener('blur', (e) => {
            if (e.target.classList.contains('editable') || e.target.classList.contains('report-field')) {
                saveData();
            }
        }, true);

        // Ø°Ø®ÛŒØ±Ù‡ Ù†Ø§Ù… ØµØ§Ø­Ø¨ Ø¨Ø±Ù†Ø§Ù…Ù‡
        document.getElementById('ownerName').addEventListener('change', (e) => {
            localStorage.setItem('ownerName', e.target.value);
        });

        // ØªØºÛŒÛŒØ± ØªØ§Ø±ÛŒØ®
        document.getElementById('date').addEventListener('change', (e) => {
            saveData();
            loadDateData(e.target.value);
        });

        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
        });
    </script>
</body>
</html>
